<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Document</title>
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.8.2/css/all.css">
    <!-- Google Fonts -->
    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,500,700&display=swap">
    <!-- Bootstrap core CSS -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.4.1/css/bootstrap.min.css" rel="stylesheet">
    <!-- Material Design Bootstrap -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/mdbootstrap/4.14.0/css/mdb.min.css" rel="stylesheet">
    <!-- JQuery -->
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
    <!-- Bootstrap tooltips -->
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.4/umd/popper.min.js">
    </script>
    <!-- Bootstrap core JavaScript -->
    <script type="text/javascript"
        src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.4.1/js/bootstrap.min.js"></script>
    <!-- MDB core JavaScript -->
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mdbootstrap/4.14.0/js/mdb.min.js">
    </script>
    <!-- pas touche -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.9.3/Chart.min.js"></script>
    <script src="https://connected-objects-lpdev.herokuapp.com/public/socket.io-client.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/vue/dist/vue.js"></script>
    <!-- perso -->
    <link rel="stylesheet" href="https://connected-objects-lpdev.herokuapp.com/public/style.css">
    <style>
        .custom-control-input:checked~.green::before {
            border-color: green;
            background-color: green;
        }
        .custom-control-input:checked~.blue::before {
            border-color: blue;
            background-color: blue;
        }
        .custom-control-input:checked~.red::before {
            border-color: red;
            background-color: red;
        }
    </style>
</head>

<body>
    <nav class="navbar navbar-light bg-light w-100 mb-3">
        <a class="navbar-brand" href="/">
            Retour
        </a>
    </nav>
    <section class="container-fluid w-100" id="container">
        <section class="row">
            <div class="col-sm-12 d-flex flex-column justify-content-center align-items-center">
                <h1>GRAPHIQUE</h1>
                <p>Température en direct</p>
            </div>
        </section>
        <canvas id="myChart" width="auto" height="300px"></canvas>
        <section class="row">
            <div class="col-12">
                <h2 class="text-center">
                    RGB CONTROL
                </h2>
            </div>
        </section>
        <section class="row p-3">
            <div class="col-4">
                <!-- Default switch -->
                <div class="custom-control custom-switch">
                    <input type="checkbox" class="custom-control-input" value="1" v-model="red" id="customSwitches1">
                    <label class="custom-control-label red" for="customSwitches1">RED</label>
                </div>
            </div>
            <div class="col-4">
                <!-- Default switch -->
                <div class="custom-control custom-switch">
                    <input type="checkbox" class="custom-control-input" value="1" v-model="green" id="customSwitches2">
                    <label class="custom-control-label green" for="customSwitches2">GREEN</label>
                </div>
            </div>
            <div class="col-4">
                <!-- Default switch -->
                <div class="custom-control custom-switch">
                    <input type="checkbox" class="custom-control-input" value="1" v-model="blue" id="customSwitches3">
                    <label class="custom-control-label blue" for="customSwitches3">BLUE</label>
                </div>
            </div>
        </section>
    </section>

    <script>
        new Vue({
            el: '#container',
            data() {
                return {
                    socket: null,
                    dateList: [],
                    temperatureList: [],
                    chart: null,
                    ctx: null,
                    red: false,
                    green: false,
                    blue: false
                }
            },
            mounted() {
                this.socket = io('https://connected-objects-lpdev.herokuapp.com/');
                //this.socket = io('http://127.0.0.1:8080/')
                this.socket.on('connect', () => {
                    console.log('connected to the remote server');
                })
                this.socket.on('newTemperature', (data) => {
                    // this.temperatureList.push(data.val)
                    // this.dateList.push(data.date)
                    console.log('la')
                    this.chart.data.labels.push(data.date);
                    if (this.chart.data.labels.length >= 10) {
                            this.chart.data.labels.shift();
                    }
                    this.chart.data.datasets.forEach((dataset) => {
                        dataset.data.push(data.val);
                        if (dataset.data.length >= 10) {
                            dataset.data.shift();
                        }
                    });
                    this.chart.update();
                })
                this.ctx = document.getElementById('myChart').getContext('2d');
                this.chart = new Chart(this.ctx, {
                    // The type of chart we want to create
                    type: 'line',
                    // The data for our dataset
                    data: {
                        labels: [],
                        datasets: [{
                            label: 'Historique de la température',
                            backgroundColor: 'rgba(255, 99, 132,0)',
                            borderColor: 'rgb(255, 99, 132)',
                            data: []
                        }]
                    },

                    // Configuration options go here
                    options: {}
                });
            },
            computed: {
                color() {
                    let r;
                    let g;
                    let b;
                    (this.red) ? r = 1: r = 0;
                    (this.green) ? g = 1: g = 0;
                    (this.blue) ? b = 1: b = 0;
                    return {
                        r: r,
                        g: g,
                        b: b
                    };
                },
                temperature() {
                    if (this.temperatureList.length > 0) {
                        return this.temperatureList[this.temperatureList.length - 1]
                    } else {
                        return null
                    }
                }
            },
            watch: {
                color(val) {
                    console.log(val)
                    this.socket.emit('newColor', val)
                }
            }
        })
    </script>
</body>

</html>